<div class="container">
    <!-- Progression -->
    <div class="progress-container">
        <div class="progress-bar" [style.width]="progressWidth"></div>
    </div>

    <form (ngSubmit)="onSubmit()">
        <!-- Ã‰tape 0 : Serrurerie -->
        <div *ngIf="currentStep === 0" class="content-row">
            <div class="col-left">
                <img src="https://avatars.mds.yandex.net/i?id=b99be685e74ef439259e8820e416b7d4-4949521-images-thumbs&n=13"
                    alt="Serrurerie">
            </div>
            <div class="col-right">
                <<h2> Carrelage</h2>
                    <p>
                        Pour la <strong>pose de carrelage mural ou au sol</strong>, la rÃ©novation de votre salle de
                        bain, cuisine,
                        ou encore la rÃ©alisation de terrasses et espaces extÃ©rieurs, trouvez un carreleur expÃ©rimentÃ©
                        qui saura rÃ©pondre Ã  vos attentes avec prÃ©cision et professionnalisme.
                    </p>

                    <ul class="service-list">
                        <li><span class="check">âœ”</span> <strong>Pose murale et au sol</strong></li>
                        <li><span class="check">âœ”</span> <strong>Finitions soignÃ©es</strong></li>
                        <li><span class="check">âœ”</span> <strong>Devis rapide et transparent</strong></li>
                    </ul>
            </div>
        </div>

        <!-- Ã‰tape 1 -->
        <div *ngIf="currentStep === 1" class="mt-4 mb-5">
            <h2>Ã‰tape 1 â€“ Donnez un titre Ã  votre projet</h2>
            <p class="text-muted">Exemple : Installation dâ€™une prise ou dâ€™un interrupteur</p>
            <div class="mb-3">
                <input id="projectTitle" type="text" class="form-control" [(ngModel)]="projectTitle" name="projectTitle"
                    placeholder="Titre du projet" />
            </div>
        </div>

        <!-- Ã‰tape 2 -->
        <div *ngIf="currentStep === 2" class="mt-4">
            <h2>Ã‰tape 2 â€“ PrÃ©cisions sur votre demande</h2>
            <p class="text-muted">Exemple : Pose dâ€™un carrelage mural ou au sol</p>
            <p>Choisissez installer / remplacer / rÃ©parer...</p>
            <div class="select-options">
                <button type="button" class="select-btn" [class.active]="selectedOption === 'installer'"
                    (click)="selectOption('installer')">Installer</button>
                <button type="button" class="select-btn" [class.active]="selectedOption === 'remplacer'"
                    (click)="selectOption('remplacer')">Remplacer</button>
                <button type="button" class="select-btn" [class.active]="selectedOption === 'reparer'"
                    (click)="selectOption('reparer')">RÃ©parer</button>
            </div>
        </div>

        <!-- Ã‰tape 3 -->
        <div *ngIf="currentStep === 3" class="mt-4">
            <h2>Ã‰tape 3 â€“ Adresse</h2>
            <p>Entrez lâ€™adresse du chantier</p>
            <div class="form-group mt-3">
                <label for="adresse" class="form-label">Adresse email du chantier</label>
                <input type="email" id="adresse" name="adresseEmail" class="form-control styled-input"
                    placeholder="exemple@senfibem.com" [(ngModel)]="adresseEmail" required>
            </div>
        </div>

        <!-- Ã‰tape 4 -->
        <div *ngIf="currentStep === 4" class="mt-4">
            <h2>Ã‰tape 4 â€“ Budget</h2>
            <p>Entrez votre budget estimÃ©</p>
            <div class="budget-container">
                <span class="currency">â‚¬</span>
                <input type="number" class="budget-input" min="50" step="50" placeholder="Ex : 500" [(ngModel)]="budget"
                    name="budget">
            </div>
            <small class="text-muted">
                Exemple : 300 â€“ 1500 â‚¬ selon le type de prestation
            </small>
        </div>

        <!-- Ã‰tape 5 : Uploading -->
        <div *ngIf="currentStep === 5" class="mt-4">
            <h2>Ã‰tape 5 â€“ Uploading de documents</h2>
            <p>SÃ©lectionnez et tÃ©lÃ©versez vos documents requis.</p>

            <!-- Upload documents -->
            <div *ngIf="selectedDocuments.length > 0">
                <h3>ðŸ“‚ Documents requis pour {{ role | titlecase }}</h3>
                <div *ngFor="let doc of selectedDocuments">
                    <label>{{ doc }}</label>
                    <input type="file" (change)="onFilesSelected($event, doc)" accept="image/*,.pdf" multiple>
                </div>
            </div>

            <!-- Preview -->
            <div class="preview-images mt-3" *ngIf="uploadedFiles.length > 0">
                <h4>ðŸ“‘ Fichiers sÃ©lectionnÃ©s :</h4>
                <div *ngFor="let file of uploadedFiles" class="preview-item">
                    <span class="file-name">{{ file.docName }} â†’ {{ file.name }}</span>
                    <img *ngIf="file.url && file.url.startsWith('data:image')" [src]="file.url" [alt]="file.name">
                </div>
            </div>

            <!-- Infos complÃ©mentaires -->
            <div class="mt-4">
                <h3>Informations complÃ©mentaires</h3>

                <!-- Si particulier -->
                <div *ngIf="role === 'PARTICULIER'">
                    <input type="text" class="form-control mb-2" placeholder="PrÃ©nom" [(ngModel)]="firstName"
                        name="firstName">
                    <input type="text" class="form-control mb-2" placeholder="Nom" [(ngModel)]="lastName"
                        name="lastName">
                    <input type="email" class="form-control mb-2" placeholder="Email" [(ngModel)]="accountEmail"
                        name="accountEmail">
                </div>

                <!-- Si professionnel -->
                <div *ngIf="role === 'PROFESSIONNEL'">
                    <input type="text" class="form-control mb-2" placeholder="Nom de lâ€™entreprise"
                        [(ngModel)]="companyName" name="companyName">
                    <input type="text" class="form-control mb-2" placeholder="NINEA" [(ngModel)]="ninea" name="ninea">
                    <input type="text" class="form-control mb-2" placeholder="Adresse" [(ngModel)]="companyAddress"
                        name="companyAddress">
                </div>

                <button class="btn btn-primary mt-3" type="submit">Valider</button>
            </div>
        </div>

        <!-- Ã‰tapes 6 Ã  12 -->
        <!-- (inchangÃ©es sauf ajout de name="..." partout oÃ¹ [(ngModel)] est utilisÃ©) -->

        <!-- Exemple Ã‰tape 12 -->
        <div *ngIf="isStep12()" class="mt-4 account-container">
            <h2>Ã‰tape 12 â€“ CrÃ©er votre compte</h2>

            <div class="user-type mt-3">
                <label><strong>Vous Ãªtes :</strong></label>
                <div class="btn-group flex-wrap">
                    <button *ngFor="let cat of categories" type="button" class="btn btn-outline-primary m-1"
                        [class.active]="userCategory === cat.key" (click)="selectCategory(cat.key)">
                        {{ cat.label }}
                    </button>
                </div>
            </div>

            <!-- Infos personnelles -->
            <div class="personal-info mt-3">
                <input type="text" class="form-control mb-2" placeholder="PrÃ©nom" [(ngModel)]="firstName"
                    name="firstName">
                <input type="text" class="form-control mb-2" placeholder="Nom" [(ngModel)]="lastName" name="lastName">
                <input type="email" class="form-control mb-2" placeholder="Email" [(ngModel)]="accountEmail"
                    name="accountEmail">
                <input type="tel" class="form-control mb-2" placeholder="TÃ©lÃ©phone" [(ngModel)]="phone" name="phone">
                <input type="password" class="form-control mb-2" placeholder="Mot de passe" [(ngModel)]="password"
                    name="password">

                <div class="form-check mb-2">
                    <input type="checkbox" [(ngModel)]="marketingConsent" name="marketingConsent"
                        class="form-check-input">
                    <label class="form-check-label">Je souhaite recevoir des infos marketing.</label>
                </div>
                <div class="form-check">
                    <input type="checkbox" [(ngModel)]="acceptTerms" name="acceptTerms" class="form-check-input"
                        required>
                    <label class="form-check-label">Jâ€™accepte les conditions gÃ©nÃ©rales.</label>
                </div>
            </div>
        </div>

        <!-- PrÃ©cision -->
        <div class="recap-precision mt-3">
            <label for="precision" class="form-label">Une prÃ©cision Ã  ajouter ?</label>
            <textarea id="precision" class="form-control" [(ngModel)]="precision" name="precision"
                placeholder="Ex : DÃ©placer l'Ã©vier..."></textarea>
        </div>

        <!-- Navigation -->
        <div class="btn-group mt-4">
            <button type="button" class="btn btn-warning me-2" (click)="prevStep()"
                [disabled]="currentStep === 0">PrÃ©cÃ©dent</button>
            <button type="button" class="btn btn-primary" (click)="nextStep()" [disabled]="!canGoNextStep()">
                {{ currentStep === 0 ? 'DÃ©marrer' : (isStep12() ? 'Sâ€™inscrire et publier' : 'Suivant') }}
            </button>
        </div>
    </form>
</div>